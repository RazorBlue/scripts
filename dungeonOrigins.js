/*! For license information please see tw-dungeon-release.js.LICENSE.txt */
(()=>{"use strict";class t{constructor(t){this.data=t}}class e extends t{constructor(t,e){super(e),this.node=t}}class n extends t{constructor(){super()}}class r extends t{constructor(){super()}}class i extends t{constructor(){super()}}class o extends t{constructor(){super()}}class s extends t{constructor(){super()}}const u=t=>{const[e]=t.getElementsByClassName("btn-need-energy");return e},c=t=>{const[e]=t.getElementsByClassName("confirmation-box");if(e&&"none"!==e.parentElement.style.display){const[t]=e.getElementsByClassName("evt-confirm-btn");return t}},a=t=>{t&&(t.focus(),t.style.borderColor="red",t.style.borderWidth="5px",t.style.borderStyle="solid")};var l=function(t,e){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function d(t,e){function n(){this.constructor=t}l(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function h(t){return"function"==typeof t}var p=!1,f={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack,p=t},get useDeprecatedSynchronousErrorHandling(){return p}};function y(t){setTimeout((function(){throw t}),0)}var b={closed:!0,next:function(t){},error:function(t){if(f.useDeprecatedSynchronousErrorHandling)throw t;y(t)},complete:function(){}},v=function(){return Array.isArray||function(t){return t&&"number"==typeof t.length}}();function m(t){return null!==t&&"object"==typeof t}var w=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),g=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var e;if(!this.closed){var n=this,r=n._parentOrParents,i=n._ctorUnsubscribe,o=n._unsubscribe,s=n._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,r instanceof t)r.remove(this);else if(null!==r)for(var u=0;u<r.length;++u)r[u].remove(this);if(h(o)){i&&(this._unsubscribe=void 0);try{o.call(this)}catch(t){e=t instanceof w?_(t.errors):[t]}}if(v(s)){u=-1;for(var c=s.length;++u<c;){var a=s[u];if(m(a))try{a.unsubscribe()}catch(t){e=e||[],t instanceof w?e=e.concat(_(t.errors)):e.push(t)}}}if(e)throw new w(e)}},t.prototype.add=function(e){var n=e;if(!e)return t.EMPTY;switch(typeof e){case"function":n=new t(e);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof t)){var r=n;(n=new t)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var i=n._parentOrParents;if(null===i)n._parentOrParents=this;else if(i instanceof t){if(i===this)return n;n._parentOrParents=[i,this]}else{if(-1!==i.indexOf(this))return n;i.push(this)}var o=this._subscriptions;return null===o?this._subscriptions=[n]:o.push(n),n},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}();function _(t){return t.reduce((function(t,e){return t.concat(e instanceof w?e.errors:e)}),[])}var E=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),x=function(t){function e(n,r,i){var o=t.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=b;break;case 1:if(!n){o.destination=b;break}if("object"==typeof n){n instanceof e?(o.syncErrorThrowable=n.syncErrorThrowable,o.destination=n,n.add(o)):(o.syncErrorThrowable=!0,o.destination=new T(o,n));break}default:o.syncErrorThrowable=!0,o.destination=new T(o,n,r,i)}return o}return d(e,t),e.prototype[E]=function(){return this},e.create=function(t,n,r){var i=new e(t,n,r);return i.syncErrorThrowable=!1,i},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},e}(g),T=function(t){function e(e,n,r,i){var o,s=t.call(this)||this;s._parentSubscriber=e;var u=s;return h(n)?o=n:n&&(o=n.next,r=n.error,i=n.complete,n!==b&&(h((u=Object.create(n)).unsubscribe)&&s.add(u.unsubscribe.bind(u)),u.unsubscribe=s.unsubscribe.bind(s))),s._context=u,s._next=o,s._error=r,s._complete=i,s}return d(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;f.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,n=f.useDeprecatedSynchronousErrorHandling;if(this._error)n&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)n?(e.syncErrorValue=t,e.syncErrorThrown=!0):y(t),this.unsubscribe();else{if(this.unsubscribe(),n)throw t;y(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var n=function(){return t._complete.call(t._context)};f.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),f.useDeprecatedSynchronousErrorHandling)throw t;y(t)}},e.prototype.__tryOrSetError=function(t,e,n){if(!f.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,n)}catch(e){return f.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):(y(e),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(x),S=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function I(t){return t}function N(t){return 0===t.length?I:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var k=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var r=this.operator,i=function(t,e,n){if(t){if(t instanceof x)return t;if(t[E])return t[E]()}return t||e||n?new x(t,e,n):new x(b)}(t,e,n);if(r?i.add(r.call(i,this.source)):i.add(this.source||f.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),f.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){f.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),function(t){for(;t;){var e=t,n=e.closed,r=e.destination,i=e.isStopped;if(n||i)return!1;t=r&&r instanceof x?r:null}return!0}(t)?t.error(e):console.warn(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=C(e))((function(e,r){var i;i=n.subscribe((function(e){try{t(e)}catch(t){r(t),i&&i.unsubscribe()}}),r,e)}))},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[S]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:N(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=C(t))((function(t,n){var r;e.subscribe((function(t){return r=t}),(function(t){return n(t)}),(function(){return t(r)}))}))},t.create=function(e){return new t(e)},t}();function C(t){if(t||(t=f.Promise||Promise),!t)throw new Error("no Promise impl found");return t}var A=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new O(t,this.predicate,this.thisArg))},t}(),O=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.predicate=n,i.thisArg=r,i.count=0,i}return d(e,t),e.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)},e}(x),P=function(){function t(t){this.value=t}return t.prototype.call=function(t,e){return e.subscribe(new L(t,this.value))},t}(),L=function(t){function e(e,n){var r=t.call(this,e)||this;return r.value=n,r}return d(e,t),e.prototype._next=function(t){this.destination.next(this.value)},e}(x);const B=t=>{return((t,e={subtree:!0,attributes:!1,childList:!0,characterData:!1})=>new k((n=>{const r=new MutationObserver(((t,e)=>{n.next(t)}));return r.observe(t,e),()=>{r.disconnect()}})))(t).pipe((e=t=>t.some((t=>{const{target:e,addedNodes:n}=t;return e.classList.contains("dungeon-crawler-tiles")?(console.debug("Update: Tiles Updated"),!0):e.classList.contains("confirmation-buttons")?(console.debug("Update: Confirmation Pending"),!0):e.classList.contains("dungeon-crawler-dungeon")&&Array.from(n).some((t=>t.classList.contains("dungeon-crawler-new-game")))?(console.debug("Update: New Game Ready"),!0):e.classList.contains("popup_box_content")?(console.debug("Update: Shop Open"),!0):"dungeon_crawler_energy_display"===e.id&&"5 / 5"===e.innerText&&(console.debug("Update: New Game Ready - Energy Update"),!0)})),function(t){return t.lift(new A(e,undefined))}),(void 0,function(t){return t.lift(new P(undefined))}));var e};function D(t){return t&&"function"==typeof t.schedule}var j=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return d(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(x),U=function(t){function e(e,n,r){var i=t.call(this)||this;return i.parent=e,i.outerValue=n,i.outerIndex=r,i.index=0,i}return d(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(x),H=function(t){return function(e){for(var n=0,r=t.length;n<r&&!e.closed;n++)e.next(t[n]);e.complete()}};function Y(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var V=Y(),M=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function F(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}var R=function(t){if(t&&"function"==typeof t[S])return r=t,function(t){var e=r[S]();if("function"!=typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)};if(M(t))return H(t);if(F(t))return n=t,function(t){return n.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,y),t};if(t&&"function"==typeof t[V])return e=t,function(t){for(var n=e[V]();;){var r=void 0;try{r=n.next()}catch(e){return t.error(e),t}if(r.done){t.complete();break}if(t.next(r.value),t.closed)break}return"function"==typeof n.return&&t.add((function(){n.return&&n.return()})),t};var e,n,r,i=m(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+i+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function q(t,e,n,r,i){if(void 0===i&&(i=new U(t,n,r)),!i.closed)return e instanceof k?e.subscribe(i):R(e)(i)}function $(t,e){return new k((function(n){var r=new g,i=0;return r.add(e.schedule((function(){i!==t.length?(n.next(t[i++]),n.closed||r.add(this.schedule())):n.complete()}))),r}))}function G(t,e){return e?$(t,e):new k(H(t))}var z={};function W(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=void 0,r=void 0;return D(t[t.length-1])&&(r=t.pop()),"function"==typeof t[t.length-1]&&(n=t.pop()),1===t.length&&v(t[0])&&(t=t[0]),G(t,r).lift(new K(n))}var K=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new X(t,this.resultSelector))},t}(),X=function(t){function e(e,n){var r=t.call(this,e)||this;return r.resultSelector=n,r.active=0,r.values=[],r.observables=[],r}return d(e,t),e.prototype._next=function(t){this.values.push(z),this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var n=0;n<e;n++){var r=t[n];this.add(q(this,r,void 0,n))}}},e.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},e.prototype.notifyNext=function(t,e,n){var r=this.values,i=r[n],o=this.toRespond?i===z?--this.toRespond:this.toRespond:0;r[n]=e,0===o&&(this.resultSelector?this._tryResultSelector(r):this.destination.next(r.slice()))},e.prototype._tryResultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(j);function J(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[t.length-1];return D(n)?(t.pop(),$(t,n)):G(t)}function Q(t,e){return function(n){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new Z(t,e))}}var Z=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new tt(t,this.project,this.thisArg))},t}(),tt=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.project=n,i.count=0,i.thisArg=r||i,i}return d(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(x);function et(t,e){return e?function(t,e){if(null!=t){if(function(t){return t&&"function"==typeof t[S]}(t))return function(t,e){return new k((function(n){var r=new g;return r.add(e.schedule((function(){var i=t[S]();r.add(i.subscribe({next:function(t){r.add(e.schedule((function(){return n.next(t)})))},error:function(t){r.add(e.schedule((function(){return n.error(t)})))},complete:function(){r.add(e.schedule((function(){return n.complete()})))}}))}))),r}))}(t,e);if(F(t))return function(t,e){return new k((function(n){var r=new g;return r.add(e.schedule((function(){return t.then((function(t){r.add(e.schedule((function(){n.next(t),r.add(e.schedule((function(){return n.complete()})))})))}),(function(t){r.add(e.schedule((function(){return n.error(t)})))}))}))),r}))}(t,e);if(M(t))return $(t,e);if(function(t){return t&&"function"==typeof t[V]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new k((function(n){var r,i=new g;return i.add((function(){r&&"function"==typeof r.return&&r.return()})),i.add(e.schedule((function(){r=t[V](),i.add(e.schedule((function(){if(!n.closed){var t,e;try{var i=r.next();t=i.value,e=i.done}catch(t){return void n.error(t)}e?n.complete():(n.next(t),this.schedule())}})))}))),i}))}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}(t,e):t instanceof k?t:new k(R(t))}var nt=function(t){function e(e){var n=t.call(this)||this;return n.parent=e,n}return d(e,t),e.prototype._next=function(t){this.parent.notifyNext(t)},e.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},e}(x),rt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return d(e,t),e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(){this.destination.complete()},e}(x);function it(t,e){if(!e.closed)return t instanceof k?t.subscribe(e):R(t)(e)}function ot(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof e?function(r){return r.pipe(ot((function(n,r){return et(t(n,r)).pipe(Q((function(t,i){return e(n,t,r,i)})))}),n))}:("number"==typeof e&&(n=e),function(e){return e.lift(new st(t,n))})}var st=function(){function t(t,e){void 0===e&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}return t.prototype.call=function(t,e){return e.subscribe(new ut(t,this.project,this.concurrent))},t}(),ut=function(t){function e(e,n,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var i=t.call(this,e)||this;return i.project=n,i.concurrent=r,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return d(e,t),e.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(t){return void this.destination.error(t)}this.active++,this._innerSub(e)},e.prototype._innerSub=function(t){var e=new nt(this),n=this.destination;n.add(e);var r=it(t,e);r!==e&&n.add(r)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(rt);function ct(){return void 0===(t=1)&&(t=Number.POSITIVE_INFINITY),ot(I,t);var t}function at(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ct()(J.apply(void 0,t))}function lt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[t.length-1];return D(n)?(t.pop(),function(e){return at(t,e,n)}):function(e){return at(t,e)}}function dt(t,e){return"function"==typeof e?function(n){return n.pipe(dt((function(n,r){return et(t(n,r)).pipe(Q((function(t,i){return e(n,t,r,i)})))})))}:function(e){return e.lift(new pt(t))}}var ht,pt=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new ft(t,this.project))},t}(),ft=function(t){function e(e,n){var r=t.call(this,e)||this;return r.project=n,r.index=0,r}return d(e,t),e.prototype._next=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(t){return void this.destination.error(t)}this._innerSub(e)},e.prototype._innerSub=function(t){var e=this.innerSubscription;e&&e.unsubscribe();var n=new nt(this),r=this.destination;r.add(n),this.innerSubscription=it(t,n),this.innerSubscription!==n&&r.add(this.innerSubscription)},e.prototype._complete=function(){var e=this.innerSubscription;e&&!e.closed||t.prototype._complete.call(this),this.unsubscribe()},e.prototype._unsubscribe=function(){this.innerSubscription=void 0},e.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&t.prototype._complete.call(this)},e.prototype.notifyNext=function(t){this.destination.next(t)},e}(rt),yt=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r.pending=!1,r}return d(e,t),e.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(r,this.id,e),this},e.prototype.requestAsyncId=function(t,e,n){return void 0===n&&(n=0),setInterval(t.flush.bind(t,this),n)},e.prototype.recycleAsyncId=function(t,e,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return e;clearInterval(e)},e.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,e){var n=!1,r=void 0;try{this.work(t)}catch(t){n=!0,r=!!t&&t||new Error(t)}if(n)return this.unsubscribe(),r},e.prototype._unsubscribe=function(){var t=this.id,e=this.scheduler,n=e.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null},e}(function(t){function e(e,n){return t.call(this)||this}return d(e,t),e.prototype.schedule=function(t,e){return void 0===e&&(e=0),this},e}(g)),bt=function(){function t(e,n){void 0===n&&(n=t.now),this.SchedulerAction=e,this.now=n}return t.prototype.schedule=function(t,e,n){return void 0===e&&(e=0),new this.SchedulerAction(this,t).schedule(n,e)},t.now=function(){return Date.now()},t}(),vt=new(function(t){function e(n,r){void 0===r&&(r=bt.now);var i=t.call(this,n,(function(){return e.delegate&&e.delegate!==i?e.delegate.now():r()}))||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return d(e,t),e.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),e.delegate&&e.delegate!==this?e.delegate.schedule(n,r,i):t.prototype.schedule.call(this,n,r,i)},e.prototype.flush=function(t){var e=this.actions;if(this.active)e.push(t);else{var n;this.active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}},e}(bt))(yt),mt=new k((function(t){return t.complete()}));ht||(ht={});var wt=function(){function t(t,e,n){this.kind=t,this.value=e,this.error=n,this.hasValue="N"===t}return t.prototype.observe=function(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}},t.prototype.do=function(t,e,n){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return n&&n()}},t.prototype.accept=function(t,e,n){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,n)},t.prototype.toObservable=function(){var t;switch(this.kind){case"N":return J(this.value);case"E":return t=this.error,new k((function(e){return e.error(t)}));case"C":return function(t){return t?function(t){return new k((function(e){return t.schedule((function(){return e.complete()}))}))}(t):mt}()}throw new Error("unexpected notification kind value")},t.createNext=function(e){return void 0!==e?new t("N",e):t.undefinedValueNotification},t.createError=function(e){return new t("E",void 0,e)},t.createComplete=function(){return t.completeNotification},t.completeNotification=new t("C"),t.undefinedValueNotification=new t("N",void 0),t}();var gt=function(){function t(t,e){this.delay=t,this.scheduler=e}return t.prototype.call=function(t,e){return e.subscribe(new _t(t,this.delay,this.scheduler))},t}(),_t=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.delay=n,i.scheduler=r,i.queue=[],i.active=!1,i.errored=!1,i}return d(e,t),e.dispatch=function(t){for(var e=t.source,n=e.queue,r=t.scheduler,i=t.destination;n.length>0&&n[0].time-r.now()<=0;)n.shift().notification.observe(i);if(n.length>0){var o=Math.max(0,n[0].time-r.now());this.schedule(t,o)}else this.unsubscribe(),e.active=!1},e.prototype._schedule=function(t){this.active=!0,this.destination.add(t.schedule(e.dispatch,this.delay,{source:this,destination:this.destination,scheduler:t}))},e.prototype.scheduleNotification=function(t){if(!0!==this.errored){var e=this.scheduler,n=new Et(e.now()+this.delay,t);this.queue.push(n),!1===this.active&&this._schedule(e)}},e.prototype._next=function(t){this.scheduleNotification(wt.createNext(t))},e.prototype._error=function(t){this.errored=!0,this.queue=[],this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.scheduleNotification(wt.createComplete()),this.unsubscribe()},e}(x),Et=function(){return function(t,e){this.time=t,this.notification=e}}();const xt="TILE/TYPE/ENEMY",Tt="TILE/TYPE/DAMAGE",St="TILE/TYPE/HEALTH",It="TILE/TYPE/AVAILABLE",Nt="TILE/TYPE/EXIT",kt="TILE/TYPE/FOG",Ct="TILE/TYPE/BLOCKEDFOG",At=(t,[,e])=>{const{requiredFights:n,linkedTiles:r}=e;return t[n]=(t[n]||0)+r.size,t},Ot=(t,e)=>{const n=Array.from(t.unlockableTiles.entries()),r=Array.from(e.unlockableTiles.entries()),i=n.reduce(At,[]),o=r.reduce(At,[]);for(let t=1;t<5;t++){const e=(o[t]||0)-(i[t]||0);if(0!==e)return e}return 0},Pt=(t,e)=>t.unlockSize-e.unlockSize,Lt=([t,e])=>Math.abs((t+e)/2),Bt=(t,e,n,r,i)=>t[1]<r||e<=n[0]||!(!i||!(2*Lt(n)>=e&&Lt(t)<r||Lt(n)>=e))&&(console.debug("Risk it!"),!0),Dt=({coordinates:t},e)=>{const[n,r]=t,i=t=>e[t]??[];return[i(n)[r+1],i(n+1)[r],i(n)[r-1],i(n-1)[r]]},jt=(t,e,n,r,i)=>{if(i)r.add(t);else{if(!t||r.has(t))return;if(t.type!==n)return;r.add(t)}const[o,s,u,c]=Dt(t,e);jt(o,e,n,r),jt(s,e,n,r),jt(u,e,n,r),jt(c,e,n,r)},Ut=(t,r)=>t.pipe(Q((t=>((t,e)=>{const{dungeon:n,enemyDamage:r,playerHealth:i,playerDamage:o,level:s}=t,u={exitTile:null,boostTiles:[],availableTiles:[],enemyTiles:[]};n.forEach((t=>{t.forEach((t=>{const{type:e}=t;switch(e){case Nt:u.exitTile=t;break;case St:case Tt:u.boostTiles.push(t);break;case It:const e=Dt(t,n).filter((t=>{const e=t?.type??"";return e===kt||e===It}));u.availableTiles.push({tile:t,unlockSize:e.length});break;case xt:const r=Dt(t,n).filter((t=>t&&t.type===Ct)).reduce(((t,e)=>{const r={requiredFights:Dt(e,n).filter((t=>t&&t.type===xt)).length,linkedTiles:new Set};return jt(e,n,kt,r.linkedTiles,!0),t.set(e,r),t}),new Map);u.enemyTiles.push({tile:t,unlockableTiles:r})}}))}));const c=s>e.avoidFrom,a=u.availableTiles.sort(Pt),l=u.enemyTiles.sort(Ot);if(console.debug("Dungeon Calculation:",n,u,a,l),u.boostTiles.length)return u.boostTiles[0];if(e.useMiddle){const t=[n[2][4],n[2][3],n[2][2],n[2][1],n[2][0]].find((t=>[xt,It].includes(t.type)));if(t){if(t.type===xt&&!u.exitTile&&!c&&Bt(r,t.data.health,o,i,!1))return t;if(t.type===It)return t}}const d=t=>{const[e]=l;if(Bt(r,e.tile.data.health,o,i,t))return e.tile};if(!c&&!u.exitTile&&l.length){const t=d(!1);if(t)return t}return a.length?a[0].tile:u.exitTile?u.exitTile:l.length?d(e.riskIt):null})(t,r))),Q((t=>t?new e(t.node,t):new n))),Ht=/tile-([0-4])-([0-4])/,Yt=/white_(right|top|center|left)_/,Vt=/([0-9]+)/,Mt=/([0-9]+) - ([0-9]+)/,Ft=t=>{const[e]=t.getElementsByClassName("dungeon-crawler-level-info");if(e){const[e]=t.getElementsByClassName("level-info");return parseInt(e.innerText,10)}return 0},Rt=t=>{const[e]=t.getElementsByClassName("dungeon-crawler-health-bar");if(e){const[,t]=e.innerText.match(Vt);return parseInt(t,10)}return 1/0},qt=(t,e)=>{const[n]=t.getElementsByClassName(e);if(n){const[,t,e]=n.innerText.match(Mt)??[0,0,0];return[parseInt(t,10),parseInt(e,10)]}return[0,0]},$t=t=>{const[e]=t.getElementsByClassName("dungeon-crawler-player-info-health");return e?parseInt(e.innerText):1/0},Gt=t=>{const[e]=t.getElementsByClassName("dungeon-crawler-tiles");return e},zt=t=>{const e=(t,e)=>{const[n]=e.getElementsByClassName(t);return!!n},n=e.bind(void 0,["dungeon-crawler-item-enemy"]),r=e.bind(void 0,["dungeon-crawler-item-booster_damage"]),i=e.bind(void 0,["dungeon-crawler-item-booster_health"]),[o]=t.getElementsByClassName("dungeon-crawler-clickable");return o?n(t)?{type:xt,data:{health:Rt(t)}}:r(t)?{type:Tt}:i(t)?{type:St}:(t=>"available"===t.dataset.state)(o)?{type:It}:{type:Nt}:(t=>t.style.backgroundImage.includes("fog_blocked.png"))(t)?{type:Ct}:(t=>null!==t.style.backgroundImage.match(Yt))(t)?{type:"TILE/TYPE/REVEALED"}:{type:kt}},Wt="btn-disabled",Kt=(t,e)=>W(t.pipe(lt(void 0)),e).pipe(dt((([,t])=>(console.debug("Config:",t),(t=>{const e=u(t);return!(!e||e.classList.contains(Wt))})(window.document)?(console.debug("Action: Should Start New Game"),J(new r)):(t=>!!c(t))(window.document)?(console.debug("Action: Should Confirm"),J(new o)):window.document.getElementById("popup_box_event_energy_shop")?(console.debug("Action: Should Shop"),J(new s)):(t=>{const e=u(t);return!(!e||!e.classList.contains(Wt))})(window.document)?(console.debug("Action: Should Open Shop"),J(new i)):(console.debug("Action: Should Continue"),Ut((()=>{const[t]=window.document.getElementsByClassName("dungeon-crawler-dungeon"),e={dungeonDOM:t,enemyDamage:qt(t,"dungeon-crawler-enemy-info-damage"),playerHealth:$t(t),playerDamage:qt(t,"dungeon-crawler-player-info-damage"),level:Ft(t),dungeon:(i=Gt(t),n=Array.from(i.children).map((t=>{const[,e,n]=t.className.match(Ht)??[];return{coordinates:[parseInt(e,10),parseInt(n,10)],id:`${e}-${n}`,node:t,...zt(t)}})),r=[[],[],[],[],[]],n.reduce(((t,e)=>{const[n,r]=e.coordinates;return t[n][r]=e,t}),r))};var n,r,i;return console.debug("Dungeon Extracted:",e),J(e)})(window.document),t))))),function(t,e){void 0===e&&(e=vt);var n,r=(n=t)instanceof Date&&!isNaN(+n)?+t-e.now():Math.abs(t);return function(t){return t.lift(new gt(r,e))}}(200));function Xt(t,e,n,r){return h(n)&&(r=n,n=void 0),r?Xt(t,e,n).pipe(Q((function(t){return v(t)?r.apply(void 0,t):r(t)}))):new k((function(r){Jt(t,e,(function(t){arguments.length>1?r.next(Array.prototype.slice.call(arguments)):r.next(t)}),r,n)}))}function Jt(t,e,n,r,i){var o;if(function(t){return t&&"function"==typeof t.addEventListener&&"function"==typeof t.removeEventListener}(t)){var s=t;t.addEventListener(e,n,i),o=function(){return s.removeEventListener(e,n,i)}}else if(function(t){return t&&"function"==typeof t.on&&"function"==typeof t.off}(t)){var u=t;t.on(e,n),o=function(){return u.off(e,n)}}else if(function(t){return t&&"function"==typeof t.addListener&&"function"==typeof t.removeListener}(t)){var c=t;t.addListener(e,n),o=function(){return c.removeListener(e,n)}}else{if(!t||!t.length)throw new TypeError("Invalid event target");for(var a=0,l=t.length;a<l;a++)Jt(t[a],e,n,r,i)}r.add(o)}const Qt=(t,e=[])=>{const n=document.createElement(t);return n.classList.add(...e),n};!function(t){const l="DO NOT RUN ME TWICE";if(window.tw_dungeon_script===l)return;window.tw_dungeon_script=l;const{avoidInputUpdate$:d,middleInputUpdate$:h,riskInputUpdate$:p}=(t=>{const e=Qt("style");e.innerText="\n.syk-tw-event-card {\n  box-shadow: 0 4px 4px 0 rgba(0,0,0,0);\n  border-radius: 2px;\n  background-color: #CBBB99;\n  padding: 0 1rem;\n  position: relative;\n  font-family: Arial, Helvetica, sans-serif;\n  color: #3d3d3d;\n  font-weight: normal;\n  margin: 1rem 2rem;\n}\n\n.syk-tw-event-info {\n  position: absolute;\n  top: 0;\n  left: 0;\n  padding: 0.2rem 0.4rem;\n  background-color: #BA9C60;\n  border-right: 1px solid #917a4c;\n  border-bottom: 1px solid #917a4c;\n  border-radius: 0 0 4px 0;\n}\n\n.syk-tw-event-config {\n  padding-top: 2rem;\n  display: flex;\n  justify-content: space-around;\n  padding-bottom: 1rem;\n}\n\n.syk-tw-event-config label input {\n  margin-left: 10px;\n  border: 1px solid #3d3d3d;\n  border-radius: 2px;\n}\n\n.syk-tw-event-config label input[type=number] {\n  display: inline-block;\n  width: 2rem;\n  padding: 0.2rem 0.4rem;\n}\n\n.syk-tw-event-config label input[type=checkbox] {\n  display: inline-block;\n  vertical-align: middle;\n  margin-top: 0;\n  height: 1.4rem;\n  width: 1.4rem;\n}";const n=Qt("div"),r=Qt("div",["syk-tw-event-card"]),i=Qt("div",["syk-tw-event-info"]);i.innerText="â¤ï¸ from w116 sykini. v1.2.2";const o=Qt("div",["syk-tw-event-config"]),s=Qt("input");s.type="checkbox",s.name="force_middle";const u=Qt("label");u.innerText="Force Middle Exploration:",u.appendChild(s);const c=Qt("input");c.type="number",c.value=0;const a=Qt("label");a.innerText="Avoid Fights Above Level:",a.appendChild(c);const l=Qt("input");l.type="checkbox",l.name="risk_it";const d=Qt("label");return d.innerText="Risk It For A Biscuit:",d.appendChild(l),o.appendChild(u),o.appendChild(a),o.appendChild(d),r.appendChild(i),r.appendChild(o),n.appendChild(e),n.appendChild(r),t.appendChild(n),{avoidInputUpdate$:Xt(c,"change"),middleInputUpdate$:Xt(s,"change"),riskInputUpdate$:Xt(l,"change")}})(t.getElementById("event_top_section"));Kt(B(window.document),((t,e,n)=>W(t.pipe(Q((t=>parseInt(t.target.value,10))),lt(0)),e.pipe(Q((t=>t.target.checked)),lt(!1)),n.pipe(Q((t=>t.target.checked)),lt(!1))).pipe(Q((([t,e,n])=>({avoidFrom:t,useMiddle:e,riskIt:n})))))(d,h,p)).subscribe((t=>t instanceof r?a(u(window.document)):t instanceof e?a(t.node.children[0]):t instanceof n?a((t=>{const[e]=t.getElementsByClassName("dungeon-crawler-restart"),[n]=e.getElementsByTagName("button");return n})(window.document)):t instanceof o?a(c(window.document)):t instanceof i?a(window.document.getElementById("buy-energy-link")):t instanceof s?a((t=>{const e=window.document.getElementById("popup_box_event_energy_shop"),[,,n]=e.getElementsByClassName("offer"),[r]=n.getElementsByClassName("btn");return r})()):void 0))}(window.document)})();
